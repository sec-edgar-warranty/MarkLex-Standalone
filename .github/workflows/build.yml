name: Build and Test (DISABLED)

on:
  # Disabled - use "Fixed Release" instead
  # push:
  #   branches: [ main, develop ]
  # pull_request:
  #   branches: [ main ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Run basic tests
      run: |
        python -c "import sys; print(f'Python {sys.version}')"
        python -c "import PyQt6; print('PyQt6 imported successfully')"
        python -c "import src.main_window; print('Main window module imported successfully')"

  build-linux:
    needs: test
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          libxcb-xinerama0 \
          libxcb-cursor0 \
          libgl1-mesa-glx \
          libegl1-mesa \
          libxrandr2 \
          libxss1 \
          libxcursor1 \
          libxcomposite1 \
          libasound2 \
          libxi6 \
          libxtst6
        
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Build Linux executable
      run: |
        pyinstaller MarkLex-Linux.spec
        cd dist
        tar -czf MarkLex-Linux-x86_64.tar.gz MarkLex
        
    - name: Upload Linux build
      uses: actions/upload-artifact@v4
      with:
        name: MarkLex-Linux-x86_64
        path: dist/MarkLex-Linux-x86_64.tar.gz

  build-windows:
    needs: test
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Build Windows executable
      run: |
        pyinstaller MarkLex-Windows.spec
        cd dist
        powershell Compress-Archive -Path MarkLex -DestinationPath MarkLex-Windows-x86_64.zip
        
    - name: Upload Windows build
      uses: actions/upload-artifact@v4
      with:
        name: MarkLex-Windows-x86_64
        path: dist/MarkLex-Windows-x86_64.zip

  build-macos:
    needs: test
    runs-on: macos-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Build macOS app
      run: |
        pyinstaller MarkLex.spec
        cd dist
        zip -r MarkLex-macOS-x86_64.zip MarkLex.app
        
    - name: Upload macOS build
      uses: actions/upload-artifact@v4
      with:
        name: MarkLex-macOS-x86_64
        path: dist/MarkLex-macOS-x86_64.zip

  build-macos-arm64:
    needs: test
    runs-on: macos-14  # macOS with Apple Silicon
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Build macOS ARM64 app
      run: |
        pyinstaller MarkLex.spec
        cd dist
        zip -r MarkLex-macOS-arm64.zip MarkLex.app
        
    - name: Upload macOS ARM64 build
      uses: actions/upload-artifact@v4
      with:
        name: MarkLex-macOS-arm64
        path: dist/MarkLex-macOS-arm64.zip